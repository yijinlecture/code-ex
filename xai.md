# Granger vs VAR – 변수 설명력 이해하기

## 1. 통계모델이 필요한 이유
- 머신러닝 모델은 **예측**에는 강하지만, **“왜 그렇게 됐는지”** 설명은 부족.  
- 우리는 **y(pH)** 같은 타깃 값에 대해 **“a(투입량) 변수가 얼마나 중요한지, 언제 영향을 주는지”**를 알고 싶음.  
- 이를 위해 사용하는 대표적인 통계적 접근이 **Granger 인과관계 검정**과 **VAR(Vector AutoRegression)**.

---

## 2. Granger Causality Test

### 원리
- 가설검정 기반 접근.  
- 두 시계열 \(X, Y\)에서, “과거 X 값이 Y의 미래를 더 잘 예측하는가?”를 검정.  
- **귀무가설(H0)**: X의 과거는 Y 예측에 도움이 안 됨.  
- **대립가설(H1)**: X의 과거가 Y 예측력을 유의하게 높임.

### 동작 방식
1. **기본 모델**: Yt​=f(Yt−1​,Yt−2​,…)
2. **확장 모델**: Yt​=f(Yt−1​,Yt−2​,…,Xt−1​,Xt−2​,…)
3. 두 모델의 성능 차이를 F-test로 검정.  

### 해석
- lag=6에서 p < 0.05 → X(불소)의 과거 값이 Y(pH)를 30분 뒤 더 잘 설명.  
- 즉, **“X는 Y를 Granger 인과한다”**라고 말할 수 있음.

---

## 3. VAR (Vector AutoRegression)

### 원리
- 여러 변수들을 동시에 자기회귀 모형에 넣어, **시스템 전체 동학**을 모델링.  
- 각 변수는 자신의 과거뿐 아니라 다른 변수들의 과거에도 영향을 받음.

### 동작 방식
- 예:  
 yt​=a+b1​yt−1​+b2​at−1​+b3​xt−1​+… 
- 계수, 충격반응(IRF), 분산분해(FEVD)를 통해 관계 해석.

### 해석
- **계수**: 특정 변수의 과거가 Y에 미치는 방향(+)과 크기.  
- **IRF**: 변수 A에 충격 1을 주면 Y가 몇 스텝 동안 얼마나 반응하는가.  
- **FEVD**: Y의 변동성 중 몇 %가 A에 의해 설명되는가.  

---

## 4. Granger vs VAR 비교

| 구분 | Granger | VAR |
|------|----------|-----|
| 초점 | **관계가 있는가?** (예측적 인과) | **얼마나/어떻게 영향을 미치나?** (시스템적 동학) |
| 방식 | 쌍 단위 검정, lag별 p-value | 모든 변수 lag를 동시에 추정 |
| 산출물 | 유의한 lag와 p-value | 계수표, IRF, FEVD |
| 용도 | “A가 Y에 영향을 주는가?” 탐색 | “A가 Y를 얼마나 설명하는가?” 정량화 |

---

## 5. 우리가 얻을 수 있는 것
1. **Granger**  
   - 변수 a가 y에 영향을 주는지 **유무**와 **시차**를 확인  
   - 예: “투입량 a는 y(pH)에 즉각적(lag=1) 효과를 줌”  

2. **VAR**  
   - a가 y에 얼마나 기여하는지 **정량적 비율** 확인  
   - 예: “y 변동의 20%는 a 때문, 50%는 불소 때문”  
   - a 충격이 들어왔을 때 y가 **어떤 경로로 반응하는지** 확인  

---

## 6. “y에 대해 a의 중요성”을 해석하는 방법
- **Granger 결과**  
  - lag=1~2에서 a→y 유의 → a의 과거 값이 y 예측에 의미 있게 기여  
- **VAR 결과**  
  - IRF: a 충격 → y가 단기적으로 상승 후 점차 안정화  
  - FEVD: y 변동성 중 25%가 a로 설명됨  
- 종합 해석:  
  - “투입량 a는 y에 즉각적이고 단기적인 영향을 준다.  
    전체 변동성 기준으로 약 25%는 a 때문이며, 나머지는 불소 등 다른 변수 영향이다.”

---

## 7. 핵심 메시지
- **Granger** = “영향이 있는가, 언제 나타나는가?”  
- **VAR** = “얼마나 크게, 어떤 경로로, 전체 변동 중 몇 %인가?”  
- 두 모델을 함께 쓰면, 단순 예측을 넘어서 **데이터 설명력**을 체계적으로 이해할 수 있다.  
